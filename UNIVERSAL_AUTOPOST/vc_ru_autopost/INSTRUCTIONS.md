# Инструкция: Автоматическая публикация статей на vc.ru

Этот скрипт позволяет публиковать статьи на vc.ru, используя заранее подготовленные JSON-файлы с контентом. Поддерживается вставка текста, заголовков, цитат, списков, обложек и **картинок внутри текста**.

## 1. Установка и подготовка

1. **Зависимости**:
   Убедитесь, что все библиотеки установлены:
   ```bash
   pip install -r requirements.txt
   ```
   Если нужно обновить Playwright:
   ```bash
   python -m playwright install chromium
   ```

2. **Конфигурация**:
   В файле `.env` должны быть указаны ваши данные (для автоматического входа, если он заработает в будущем) и настройки браузера.
   При ручном входе (рекомендуется) скрипт будет использовать сохраненные cookies.

---

## 2. Авторизация (Ручной вход)

Из-за защиты от ботов, автоматический ввод логина/пароля может не работать. Используйте режим ручного входа один раз, чтобы сохранить сессию.

1. **Запустите помощника**:
   ```bash
   python manual_login_helper.py
   ```
2. **Войдите на vc.ru**:
   В открывшемся браузере авторизуйтесь любым способом (Email, Google, Yandex и т.д.). Дождитесь полной загрузки страницы с вашей аватаркой.
3. **Сохраните сессию**:
   Вернитесь в терминал и нажмите **Enter**.
   Скрипт сохранит cookies в файл `vcru_storage_state.json`.

*Эту процедуру нужно повторять только если cookies истекут (статья перестанет публиковаться).*

---

## 3. Подготовка статьи (JSON)

Создайте JSON-файл в папке `articles/` (например, `articles/my_new_article.json`).

**Формат файла:**
```json
{
  "title": "Заголовок вашей статьи",
  "content": "Текст статьи...\n\n## Подзаголовок\nТекст...\n\n[image_url:https://example.com/image.jpg|Подпись к картинке]",
  "tags": ["Маркетинг", "Личный опыт"],
  "cover_image_url": "https://example.com/cover.jpg",
  "publish": true
}
```

### Поддерживаемый формат контента (`content`):
В тексте можно использовать специальные маркеры для форматирования:
- `## Заголовок` — Подзаголовок H2 (крупный)
- `### Заголовок` — Подзаголовок H3 (средний)
- `- Пункт списка` или `• Пункт списка` — Маркированный список
- `> Цитата` — Блок цитаты
- `[image_url:ССЫЛКА|ПОДПИСЬ]` — **Вставка картинки в текст**.
  - Пример: `[image_url:https://site.com/img.png|Моя схема]`
  - Если подпись не нужна: `[image_url:https://site.com/img.png|]`

---

## 4. Публикация

Для публикации используйте `main.py`.

**Команда для публикации (черновик):**
```bash
python main.py --file articles/my_new_article.json
```

**Команда для публикации (сразу на сайт):**
```bash
python main.py --file articles/my_new_article.json --publish
```

**Опции:**
- `--publish`: Опубликовать статью сразу (иначе создастся черновик).
- `--keep-open`: Не закрывать браузер после завершения (удобно для отладки).
- `--headless`: Запустить браузер в фоновом режиме (без окна).

---

## 5. Установка обложки профиля (Дополнительно)

Если вы хотите автоматически сменить обложку профиля:
```bash
python set_profile_cover.py
```
(Использует картинку `profile_cover.jpg` из папки скрипта).

---

## Решение проблем

- **Ошибка "Refresh token has expired" или "Не удалось авторизоваться"**:
  Запустите `python manual_login_helper.py` и войдите заново.

- **Картинка не вставилась**:
  Убедитесь, что ссылка прямая (заканчивается на .jpg, .png) и доступна.

- **Ошибка 500 при публикации**:
  Скрипт умеет это обрабатывать. Он автоматически попробует нажать кнопку "Опубликовать" в интерфейсе, если API вернет ошибку.
