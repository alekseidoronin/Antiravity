# PROJECT: KONTENT KONVEIR
## TECHNICAL DESIGN DOCUMENT (TDD)

**Версия:** 2.0 (Release Candidate)  
**Статус:** Approved for Deployment  
**Владелец:** Doronin.AI  
**Дата:** 11 Февраля 2026  

---

## ОГЛАВЛЕНИЕ

1.  [ПАСПОРТ ПРОЕКТА](#1-паспорт-проекта)
    *   1.1. Концепция и Бизнес-цели
    *   1.2. Целевая аудитория и User Cases
    *   1.3. Ключевые метрики (KPI)
2.  [АРХИТЕКТУРА РЕШЕНИЯ](#2-архитектура-решения)
    *   2.1. Верхнеуровневая схема (High-Level Design)
    *   2.2. Стек технологий
    *   2.3. Топология данных
3.  [ФУНКЦИОНАЛЬНАЯ СПЕЦИФИКАЦИЯ (CORE)](#3-функциональная-спецификация-core)
    *   3.1. Модуль Оркестрации и Очереди (Queue Management)
    *   3.2. SEO-Ядро и Семантика (Semantic Core)
    *   3.3. Генеративный Текстовый Движок (LLM Engine)
    *   3.4. Графический Процессор (Image Gen & Cleanup)
4.  [КАНАЛЫ ДИСТРИБУЦИИ (OMNICHANNEL)](#4-каналы-дистрибуции-omnichannel)
    *   4.1. WordPress Hub (Central Node)
    *   4.2. Социальный граф (10 Каналов)
5.  [ЭКОНОМИКА И ТАРИФИКАЦИЯ](#5-экономика-и-тарификация)
    *   5.1. Unit-экономика одного выпуска
    *   5.2. Тарифная сетка (Mini / Plus / Premier)
6.  [БЕЗОПАСНОСТЬ И ОТКАЗОУСТОЙЧИВОСТЬ](#6-безопасность-и-отказоустойчивость)
7.  [ПЛАН РАЗВИТИЯ (ROADMAP)](#7-план-развития-roadmap)

---

## 1. ПАСПОРТ ПРОЕКТА

### 1.1. Концепция
**KONTENT KONVEIR** — это промышленная система автоматизации цифрового маркетинга. В отличие от простых автопостингов, система создаёт уникальный, семантически связанный контент (статьи, посты, визуализацию) и дистрибутирует его в 10 каналов одновременно, создавая эффект "вездесущности" бренда.

### 1.2. Бизнес-цели
1.  **Исключение рутины:** Полная замена SMM-менеджера и копирайтера на этапе создания чернового и чистового контента.
2.  **SEO-доминирование:** Создание ссылочной массы через WordPress-блог и перелинковку из соцсетей.
3.  **Омниканальность:** Охват аудитории в 10 экосистемах (Meta, Telegram, VK, Yandex, LinkedIn, Pinterest).

### 1.3. User Cases (Сценарии использования)
*   **Сценарий "Expert":** Эксперт загружает тему "Тренды AI 2026" в таблицу → через 10 минут статья на сайте + посты во всех соцсетях.
*   **Сценарий "Business":** E-com проект загружает карточку товара → система генерирует продающее описание и разгоняет его по визуальным сетям (Pinterest, Instagram).

---

## 2. АРХИТЕКТУРА РЕШЕНИЯ

### 2.1. Верхнеуровневая схема
Система построена на базе микросервисной архитектуры внутри среды **Make (ранее Integromat)**.
*   **Trigger Layer:** Google Sheets (Watcher).
*   **Logic Layer:** Make Scenario (Router, Iterators, Aggregators).
*   **Intelligence Layer:** Google Gemini (Text/Logic), OpenAI (Metadata), Wordstat (Analytics).
*   **Visual Layer:** Grsai API (Generation), Custom AI Cleanup (Post-processing).
*   **Distribution Layer:** API коннекторы 10 платформ.

### 2.2. Стек технологий
1.  **Оркестратор:** Make.com (Enterprise Plan).
2.  **LLM (Text):**
    *   Gemini 2.5 Flash-Lite (High speed, SEO tasks).
    *   Gemini 2.5 Flash (Content generation).
    *   Gemini 3 Pro Preview (Complex reasoning).
    *   OpenAI GPT-4o-mini (JSON formatting, metadata).
3.  **LLM (Image):** Grsai API (Nano Banana Pro / Fast models).
4.  **Analytics:** Yandex Wordstat API.
5.  **CMS:** WordPress (REST API v2).

---

## 3. ФУНКЦИОНАЛЬНАЯ СПЕЦИФИКАЦИЯ (CORE)

### 3.1. Модуль Оркестрации (Queue Management)
*   **Входная точка:** Google Spreadsheet, лист `Artical`.
*   **Логика выборки:** FIFO (First In, First Out). Система забирает строку №1.
*   **Атомарность:** После успешного захвата данных строка №1 удаляется (`deleteRow`), чтобы исключить дублирование.
*   **Параметры входа:**
    *   `Topic/Context`: Основная тема.
    *   `Reference Images`: Массив ссылок на стиль/персонажа.
    *   `Tone of Voice`: (опционально) стиль речи.

### 3.2. SEO-Ядро (Semantic Core)
Уникальная особенность проекта — работа не "от фантазии", а от спроса.
1.  **Extraction (ID 54):** Gemini анализирует тему и выделяет 3 вектора поиска (K1, K2, K3).
2.  **Validation (ID 3):** Запрос к **Yandex Wordstat**.
    *   *RegionID:* 121479 (Гео-привязка).
    *   *Depth:* Топ-10 запросов по каждому вектору.
3.  **Synthesis (ID 56):** Gemini 2.5 Flash-Lite анализирует частотность и генерирует "Кликбейтный, но безопасный" заголовок (CTR optimize, Zensafety check).

### 3.3. Генеративный Текстовый Движок
Система генерирует *разный* контент для разных платформ из одной сущности.
*   **Статья (Long-read):** HTML-разметка, h2-h3 теги, списки, таблицы. Объем 3000+ знаков.
*   **Микро-посты (Threads/Twitter):** Сжатие смысла до 500 символов, тред-структура.
*   **Визуальные описания (Pinterest/Instagram):** Акцент на эмоциональные триггеры + хештеги.
*   **Мета-данные (ID 103):** GPT-4o-mini формирует технический JSON:
    *   `Alt-text`: для слепых и поисковиков.
    *   `Filename`: транслитерация для SEO URL (e.g., `ai-trends-2026.jpg`).

### 3.4. Графический Процессор (Visual Core)
Используется внешний агрегатор **Grsai API**.
1.  **Prompt Engineering:** Gemini переписывает тему в промпт для генерации (Lighting, Composition, Lens type).
2.  **Generation Request:**
    *   Model: `nano-banana-pro` (High quality).
    *   Aspect Ratio: `16:9` (Cover), `4:5` (Social).
    *   Reference Control: Передача лица/стиля через массив URL.
3.  **Async Handling:** Реализован цикл ожидания (`Sleep 150s` + `Resume`), так как генерация занимает время.
4.  **AI Cleanup (New Feature):** Промежуточный модуль постобработки. Удаляет артефакты, водяные знаки нейросетей, делая изображение фотореалистичным.
5.  **Output:** 2 уникальных изображения на выпуск (Обложка + Баннер внутри статьи).

---

## 4. КАНАЛЫ ДИСТРИБУЦИИ (10 NODES)

Система публикует контент в 10 независимых каналов.

### 4.1. Центральный Узел: WordPress (Blog)
Является "сердцем" SEO-стратегии.
*   **Тип сущности:** `Post` (не Page).
*   **Медиа:** Загрузка в Media Library, установка `Featured Image`.
*   **SEO:** Автозаполнение Alt, Caption, Description.
*   **Статус:** `Publish` (мгновенная индексация).
*   **Категоризация:** Автоматический выбор рубрики на основе темы.

### 4.2. Социальный граф (9 Каналов + 1 Блог)

| № | Канал | Техническая реализация | Особенности контента |
|---|---|---|---|
| 1 | **ВКонтакте** | `appvkplus` (Wall Post) | Карусель/Сетка изображений. Long-read поддержка. |
| 2 | **Telegram** | `Telegra.ph` API / Bot | Instant View верстка. Markdown разметка. |
| 3 | **Pinterest** | `createPin` | Ссылка ведет на WP-статью. SEO-описание (800 симв). |
| 4 | **Instagram** | `Business API` | Post (1:1 или 4:5). Первый комментарий с хештегами. |
| 5 | **Threads** | Custom Connector | Ограничение 500 символов. Цепочки (Threads). |
| 6 | **Facebook** | Page API | Кросспостинг с Instagram или нативный пост с ссылкой. |
| 7 | **LinkedIn** | `ShareImage` API | Профессиональный тон (Tone: Formal). Visibility: Public. |
| 8 | **Одноклассники** | OK.ru API (New) | Адаптация под аудиторию 40+. Фото + Текст. |
| 9 | **Дзен** | Zen API / RSS (New) | Публикация как "Статья". Критична уникальность текста. |
| 10| **WordPress** | REST API v2 | База знаний. Источник RSS для внешних агрегаторов. |

---

## 5. ЭКОНОМИКА И ТАРИФИКАЦИЯ

### 5.1. Unit-экономика одного выпуска (Cost Per Issue)
Расчет себестоимости одного запуска конвейера (Premier тариф):
*   **Image Gen (2 шт):** Nano Banana Pro (~1800 credits) × 2 × $0.0000X ≈ **$0.18**
*   **Text Gen (Gemini):** Input + Output tokens ≈ **$0.01**
*   **Make Operations:** ~150 операций за прогон ≈ **$0.05**
*   **Итого себестоимость:** **~$0.24** за полный выпуск в 10 сетей.

### 5.2. Тарифная сетка (Commercial Model)

#### I. SETUP MINI (Entry Level)
*   **Внедрение:** $1,190 (Разово).
*   **Состав:** 4 соцсети (Meta + VK) + Pinterest.
*   **Модель:** Клиент оплачивает API сам.

#### II. SETUP PLUS (Subscription Base)
*   **Внедрение:** $690 (Разово).
*   **Подписка:**
    *   $49/мес (20 выпусков).
    *   $109/мес (50 выпусков).
    *   $179/мес (100 выпусков).
*   **Состав:** 8 соцсетей. Включены расходы на генерацию.

#### III. PREMIER (Enterprise / Organic Traffic)
*   **Внедрение:**
    *   $2,490 (WP есть).
    *   $3,490 (WP под ключ).
*   **Подписка (Full Service):**
    *   $149/мес (20 выпусков).
    *   $299/мес (50 выпусков).
    *   $499/мес (100 выпусков).
*   **Состав:** 10 каналов (вкл. Дзен, ОК) + WordPress Блог + 2 изображения/выпуск + Расширенное SEO.

---

## 6. БЕЗОПАСНОСТЬ И ОТКАЗОУСТОЙЧИВОСТЬ

### 6.1. Error Handling (Обработка сбоев)
*   **Принцип "Show Must Go On":** Каждый модуль публикации обернут в директиву `Ignore Error`. Если LinkedIn упал или токен истек, остальные 9 сетей получат контент.
*   **Retry Logic:** Модули генерации изображений имеют 3 попытки перезапроса в случае таймаута.

### 6.2. Data Security
*   Данные передаются по зашифрованным каналам (HTTPS).
*   В Blueprint не хранятся пароли в явном виде (используются Connections ID).
*   Контент проходит премодерацию через `SafetySettings` Gemini (фильтр Harassment/Hate Speech).

---

## 7. ПЛАН РАЗВИТИЯ (ROADMAP)

### Phase 1: Стабилизация (Текущий статус)
*   [x] Запуск ядра генерации (Текст + Фото).
*   [x] Интеграция основных 8 соцсетей.
*   [x] Внедрение WordPress модуля.

### Phase 2: Масштабирование (В работе)
*   [ ] **Интеграция Одноклассники (OK.ru):** Настройка OAuth 2.0 приложения, модуль публикации `mediatopic.post`.
*   [ ] **Интеграция Дзен:** Настройка RSS-трансляции из WordPress или прямое API (через Publisher API).
*   [ ] **Калибровка AI Cleanup:** Тюнинг алгоритмов очистки артефактов на сложных лицах.

### Phase 3: Аналитика
*   [ ] Сбор статистики просмотров обратно в Google Sheets (Feedback Loop).

---
*Документ утвержден к использованию во внутренней и внешней коммуникации проекта Doronin.AI.*
